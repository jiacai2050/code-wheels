* Set lexical binding
- https://www.gnu.org/software/emacs/manual/html_node/elisp/Using-Lexical-Binding.html#Using-Lexical-Binding
#+begin_src emacs-lisp
;;; -*- lexical-binding: t; -*-
#+end_src

* Languages
** Ocaml
- https://github.com/ocaml/merlin/wiki/emacs-from-scratch
#+BEGIN_SRC shell
opam install tuareg merlin utop
#+END_SRC
#+BEGIN_SRC emacs-lisp
(let ((opam-share (ignore-errors (car (process-lines "opam" "config" "var" "share")))))
  (when (and opam-share (file-directory-p opam-share))
    (add-to-list 'load-path (expand-file-name "emacs/site-lisp" opam-share))
    (load "tuareg-site-file")
    ;; (load "merlin")
    (autoload 'merlin-mode "merlin" nil t nil)
    (autoload 'utop "utop" "Toplevel for OCaml" t)
    (autoload 'utop-minor-mode "utop" "Minor mode for utop" t)
    (add-hook 'tuareg-mode-hook 'merlin-mode t)
    (setq tuareg-indent-align-with-first-arg t)
    (setq tuareg-match-patterns-aligned t)

    (add-hook 'caml-mode-hook 'merlin-mode t)
    (setq utop-command "opam config exec -- utop -emacs")
    ;; utop-minor cause merlin docstr didn't showup
    ;; (add-hook 'tuareg-mode-hook 'utop-minor-mode)
    ))
#+END_SRC

* Gpg
- https://emacs.stackexchange.com/a/32554/16450
#+BEGIN_SRC emacs-lisp
  (setq epa-pinentry-mode 'loopback)
  ;; (setq epa-file-encrypt-to "hello@liujiacai.net")
#+END_SRC
* Submodule
#+BEGIN_SRC emacs-lisp
(use-package restclient
  :load-path "~/.emacs.d/vendor/restclient"
  :mode ("\\.api\\'" . restclient-mode))

(use-package protobuf-mode
  :load-path "~/.emacs.d/vendor/protobuf-mode"
  :mode ("\\.proto\\'" . protobuf-mode))
#+END_SRC
* Git
- https://magit.vc/manual/magit/Getting-started.html#Getting-started
* Others
#+BEGIN_SRC emacs-lisp
;; Changes all yes/no questions to y/n type
(fset 'yes-or-no-p 'y-or-n-p)

(setq datetime-timezone "Asia/Shanghai")

;; shell scripts
(setq-default sh-basic-offset 2)
(setq-default sh-indentation 2)

;; No need for ~ files when editing
(setq create-lockfiles nil)

;; Go straight to scratch buffer on startup
(setq inhibit-startup-message t)

;; https://www.gnu.org/software/emacs/manual/html_node/emacs/Safe-File-Variables.html
(setq enable-local-variables :safe)

;; https://github.com/justbur/emacs-which-key
(use-package which-key
  :config (which-key-mode))

(use-package chronos
  :config
  (defun my/chronos-shell-notify (c)
    "Notify expiration of timer C by running a shell command.
https://gist.github.com/bravosierrasierra/59d6d0c1ddff46a1b87b18738cecf8a2"
    (if (eq system-type 'darwin)
        (chronos--shell-command "Chronos shell notification for Mac OS X"
                                "terminal-notifier"
                                (list "-sound" "default" "-title" "TIME OVER" "-message" (chronos--message c))
                                )
      (chronos--shell-command "Chronos shell notification for Linux & Windows"
                              "notify-send"
                              (list "-t" "3600000" "TIME OVER" (chronos--message c))))
    ;; 24*60*60*1000 = 86400000  60*60*1000 = 3600000
    )
  (defun my/stop-expired-timer (c)
    (chronos--pause c))

  (setq chronos-expiry-functions '(chronos-buffer-notify
                                   my/chronos-shell-notify
                                   chronos-message-notify
                                   my/stop-expired-timer)))

(use-package helpful
  :bind (("C-h f" . helpful-callable)
         ("C-h v" . helpful-variable)
         ("C-h k" . helpful-key)))

(use-package easy-hugo
  :commands (easy-hugo-with-env)
  :init
  (defun my/hugo-newpost (slug title tags categories)
    (interactive "sSlug: \nsTitle: \nsTags: \nsCategories: ")
    (easy-hugo-with-env
     (let* ((now (current-time))
		    (basename (concat (format-time-string "%Y-%m-%d-" now)
							  slug easy-hugo-default-ext))
		    (postdir (expand-file-name easy-hugo-postdir easy-hugo-basedir))
		    (filename (expand-file-name basename postdir)))
	   (when (file-exists-p filename)
         (error "%s already exists!" filename))
	   (find-file filename)
	   (insert
	    (format "#+TITLE: %s\n#+DATE: %s\n#+TAGS[]: %s\n#+CATEGORIES[]: %s\n"
                title (my/iso-8601-date-string) tags categories))
	   (goto-char (point-max))
	   (save-buffer))))
  :bind (:map easy-hugo-mode-map
         ("w" . my/hugo-newpost))
  :custom ((easy-hugo-basedir  "~/gh/jiacai2050.github.io/")
		   (easy-hugo-url  "https://liujiacai.net")
           (easy-hugo-default-ext ".org")
           (easy-hugo-bloglist '(((easy-hugo-basedir . "~/gh/en-blog/")
                                  (easy-hugo-default-ext ".org")
		                          (easy-hugo-url . "https://en.liujiacai.net"))))))

(defun my/google-search ()
  "Googles a query or region if any."
  (interactive)
  (ivy-read "Google: " nil
            :action (lambda (q)
                      (browse-url
                       (concat
                        "http://www.google.com/search?ie=utf-8&oe=utf-8&q=" q)))))


(defalias '-> 'thread-first)
(defalias '->> 'thread-last)
#+END_SRC
